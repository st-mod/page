var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};function n(e){const t=Number(getComputedStyle(e).fontSize.slice(0,-2));let n=1/t,i=1/t;const o=e.closest("foreignObject");if(null!==o){const{height:e,width:t}=o.getBoundingClientRect();n*=o.height.animVal.value/e,i*=o.width.animVal.value/t}return{heightScale:n,widthScale:i}}e.d(t,{i0:()=>p,IQ:()=>v,h0:()=>b,Md:()=>f,$F:()=>r,_8:()=>a});const i=r("210mm"),o=r("297mm");function r(e){return"string"!=typeof e?NaN:e.endsWith("px")?Number(e.slice(0,-2)):e.endsWith("cm")?96*Number(e.slice(0,-2))/2.54:e.endsWith("mm")?96*Number(e.slice(0,-2))/25.4:e.endsWith("in")?96*Number(e.slice(0,-2)):e.endsWith("pc")?16*Number(e.slice(0,-2)):e.endsWith("pt")?4*Number(e.slice(0,-2))/3:NaN}function a(e){if("string"!=typeof e)return{width:i,height:o};if(e.endsWith(" landscape")){const{width:t,height:n}=a(e.slice(0,-10).trim());return{width:n,height:t}}if(e.endsWith(" portrait"))return a(e.slice(0,-9).trim());if("A5"===e)return{width:r("148mm"),height:r("210mm")};if("A4"===e)return{width:r("210mm"),height:r("297mm")};if("A3"===e)return{width:r("297mm"),height:r("420mm")};if("B5"===e)return{width:r("176mm"),height:r("250mm")};if("B4"===e)return{width:r("250mm"),height:r("353mm")};if("JIS-B5"===e)return{width:r("182mm"),height:r("257mm")};if("JIS-B4"===e)return{width:r("257mm"),height:r("364mm")};if("letter"===e)return{width:r("8.5in"),height:r("11in")};if("legal"===e)return{width:r("8.5in"),height:r("14in")};if("ledger"===e)return{width:r("11in"),height:r("17in")};const[t,n]=e.trim().split(/\s+/,2).map(r);return isFinite(t)&&t>0?void 0===n?{width:t,height:t}:isFinite(n)&&n>0?{width:t,height:n}:{width:t,height:o}:isFinite(n)&&n>0?{width:i,height:n}:{width:i,height:o}}let d;function c(e){if("string"!=typeof e)return{marginTop:".4in",marginRight:".4in",marginBottom:".4in",marginLeft:".4in"};const t=e.trim().split(/\s+/,4);return 1===t.length?{marginTop:t[0],marginRight:t[0],marginBottom:t[0],marginLeft:t[0]}:2===t.length?{marginTop:t[0],marginRight:t[1],marginBottom:t[0],marginLeft:t[1]}:3===t.length?{marginTop:t[0],marginRight:t[1],marginBottom:t[2],marginLeft:t[1]}:{marginTop:t[0],marginRight:t[1],marginBottom:t[2],marginLeft:t[3]}}function l(e){if("number"==typeof e&&isFinite(e)&&e%1==0&&e>=0)return{leftHeaderLevel:e,rightHeaderLevel:e};if("string"!=typeof e)return{leftHeaderLevel:0,rightHeaderLevel:1};const[t,n]=e.trim().split(/\s+/,2).map(Number);return isFinite(t)&&t%1==0&&t>=0?void 0===n?{leftHeaderLevel:t,rightHeaderLevel:t}:isFinite(n)&&n%1==0&&n>=0?{leftHeaderLevel:t,rightHeaderLevel:n}:{leftHeaderLevel:t,rightHeaderLevel:1}:isFinite(n)&&n%1==0&&n>=0?{leftHeaderLevel:0,rightHeaderLevel:n}:{leftHeaderLevel:0,rightHeaderLevel:1}}function s(e){const t=[];for(const n of e.headings){const i=e.unitOrLineToPosition.get(n.unit);if(void 0===i||0===i.length)continue;const o=i[0];if("number"!=typeof o)continue;const r=t[o];void 0!==r?r.push(n):t[o]=[n]}return t}function g(e,t,n,i,o){const r=e%2==0,a=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),c=document.createElement("div"),l=document.createElement("header"),s=document.createElement("main"),g=document.createElement("footer"),m=document.createElement("div"),h=document.createElement("div"),u=document.createElement("span"),p=document.createElement("span");a.append(d),d.append(c),c.append(l),c.append(s),c.append(g),l.append(m),g.append(h),m.append(u),m.append(p),a.setAttribute("viewBox",`0 0 ${n.width} ${n.height}`),d.setAttribute("width","100%"),d.setAttribute("height","100%"),c.style.fontSize="16px";const f=`calc(${i.marginLeft} + ${o})`;return c.style.marginLeft=r?i.marginRight:f,c.style.marginRight=r?f:i.marginRight,l.style.height=i.marginTop,s.style.display="flow-root",s.style.height=`calc(${n.height}px - ${i.marginTop} - ${i.marginBottom})`,g.style.height=i.marginBottom,h.textContent=t.toString(),{element:a,headingIndexEle:u,headingContentEle:p,main:s,indexEle:h,index:e,frontIndex:t}}function m(e,t,n,i,o){if(0===t&&n===1/0)return;void 0===o&&(o=e.querySelectorAll(".breakable>*"));const r=o[t-1],a=o[n-1];void 0!==r&&(i.dom.removeBefore(r,e),r.remove()),void 0!==a&&i.dom.removeAfter(a,e)}async function h(e,t,n,i,o){const r=(await o.compileSTDN([[e]])).children[0];m(r,n,i,o),t.append(r)}async function u(e,t,n,i,o,r){const a=t.cloneNode(!0),d=a.querySelectorAll(".breakable>*");if(m(a,o,1/0,r,d),n.append(a),a.getBoundingClientRect().bottom<=n.getBoundingClientRect().bottom)return a.remove(),m(t,o,1/0,r),void n.append(t);for(let t=d.length;t>o;t--)if(r.dom.removeAfter(d[t-1],a),!(a.getBoundingClientRect().bottom>n.getBoundingClientRect().bottom))return a.remove(),await h(e,n,o,t,r),t;if(a.remove(),i)return o;m(t,o,1/0,r),n.append(t)}const p=new Map,f=async(e,t)=>{const n=document.createElement("div");let i,o=p.get(t);if(void 0!==o)return n;if(i=void 0!==t.context.root?t.context.root.querySelector(":host>div"):document.body.querySelector(":scope>.lr-struct>main>article"),null===i)return n;const r=i;p.set(t,o=function(e,t){const n=new Map,i=new Map;return{binging:(d=e.binging,"number"==typeof d?`${d}px`:"string"==typeof d?d:"0px"),breakLevel:(o=e["right-level"],r=e["break-level"],("number"!=typeof o||!isFinite(o)||o%1!=0||o<0)&&(o=0),("number"!=typeof r||!isFinite(r)||r%1!=0||r<o)&&(r=o),{rightLevel:o,breakLevel:r}),elementToPage:n,headerLevel:l(e["header-level"]),lineIndexToHeadings:s(t),margin:c(e.margin),pagedListeners:[],pageIndexToHeadings:[],pages:[],size:a(e.size),unitOrLineToPage:i};var o,r,d}(e.options,t.context)),function({width:e,height:t},n){if(void 0!==n)return;void 0===d&&(d=document.createElement("style"));const i=`@page {\n    margin: 0;\n    size: ${e}px ${t}px;\n}\n\nbody>.lr-struct>main>article {\n    max-width: ${e}px;\n}`;d.textContent!==i&&(d.textContent=i),document.head.append(d)}(o.size,t.context.root);const m=o,h="number"==typeof(f=e.options["break-delay"])&&isFinite(f)&&f>=0?1e3*f:1e3;var f;return function(e,t,n){const i=new MutationObserver(d),o=window.setInterval(d,1e3);let r,a=!1;async function d(){t.isConnected&&!a&&(a=!0,i.disconnect(),clearInterval(o),await e())}r=void 0===n?document.body.querySelector(":scope>.lr-struct>main>article"):n instanceof ShadowRoot?n.querySelector(":host>div"):n,null===r&&(r=document.body),i.observe(r,{childList:!0,subtree:!0})}((async()=>{await new Promise((e=>setTimeout(e,h))),await async function(e,t,n,i){t.innerHTML="";let o=1,r=1,a=g(o,r,n.size,n.margin,n.binging);n.pages.push(a),t.append(a.element);let d=!1;function c(){n.pages.push(a=g(++o,++r,n.size,n.margin,n.binging)),t.append(a.element),d=!1}for(let t=0;t<e.length;t++){const l=e[t],s=n.lineIndexToHeadings[t];let g=1/0;if(void 0!==s&&s.length>0&&(g=Math.max(...s.map((e=>e.index.length)))),l.children.length>0){const e=l.querySelector(".break");if(null!==e){(g<=n.breakLevel.rightLevel||e.classList.contains("right"))&&o%2==1&&c();const t=e.getAttribute("index")??e.getAttribute("data-index");null!==t&&/^[1-9]\d*$/.test(t)&&(r=Number(t)-1),c()}else g<=n.breakLevel.breakLevel&&(d&&c(),g<=n.breakLevel.rightLevel&&o%2==0&&c())}if(1===l.children.length&&1===l.childNodes.length){const e=i.context.idToIndexInfo[l.children[0].id];if(void 0!==e){let t=0;for(;;){const n=await u(e.unit,l,a.main,d,t,i);if(void 0===n){!d&&l.childNodes.length>0&&l.getBoundingClientRect().height>0&&(d=!0);break}t=n,c()}continue}}a.main.append(l),!d||l.getBoundingClientRect().bottom<=a.main.getBoundingClientRect().bottom||(c(),a.main.append(l),l.childNodes.length>0&&l.getBoundingClientRect().height>0&&(d=!0))}!function(e){for(const t of e.pages){const n=document.createTreeWalker(t.main,NodeFilter.SHOW_ELEMENT);for(;;){const i=n.nextNode();if(!(i instanceof Element))break;e.elementToPage.set(i,t)}}}(n),function(e,t){t.unitOrLineToElements.forEach(((t,n)=>{if(void 0===t||0===t.length)return;let i,o=1/0;for(const n of t){const t=e.elementToPage.get(n);void 0!==t&&t.index<o&&(o=t.index,i=t)}e.unitOrLineToPage.set(n,i)}))}(n,i),function(e,t){for(const n of t.headings){const t=e.unitOrLineToPage.get(n.unit);if(void 0===t)continue;const i=e.pageIndexToHeadings[t.index];void 0!==i?i.push(n):e.pageIndexToHeadings[t.index]=[n]}}(n,i.context),await async function(e,t){const n=[t.context.titleInfo];for(const i of e.pages){const{headingIndexEle:o,headingContentEle:r,index:a}=i,d=e.pageIndexToHeadings[a];if(void 0!==d)for(const e of d){for(let t=e.index.length+1;t<n.length;t++)n[t]=void 0;n[e.index.length]=e}const c=a%2==0?e.headerLevel.leftHeaderLevel:e.headerLevel.rightHeaderLevel,l=n[c];if(void 0===l)continue;c>0&&o.append(l.index.join("."));const{abbr:s}=l.unit.options;"string"==typeof s?r.append(s):"object"==typeof s?r.append(await t.compileUnit(s)):r.append(await t.compileLine(t.base.stdnToInlinePlainStringLine(l.unit.children)))}}(n,i)}(Array.from(r.children),r,m,t);for(const e of m.pagedListeners)await e();m.pagedListeners=[],void 0!==t.context.root&&t.context.root.dispatchEvent(new Event("adjust",{bubbles:!0,composed:!0}))}),n,r),n},v=async(e,t)=>{const i=document.createElement("div"),o=p.get(t);if(void 0===o)return i;i.classList.add("breakable");const r="number"==typeof(a=e.options["dot-gap"]??t.context.extractLastGlobalOption("dot-gap","contents"))&&isFinite(a)&&a>0?a:1;var a;for(const{unit:e,index:a,id:d}of t.context.headings){const c=document.createElement("div"),l=document.createElement("span"),s=document.createElement("span"),g=document.createElement("div"),m=document.createElement("a");c.classList.add(`level${a.length}`),m.href=`#${encodeURIComponent(d)}`,i.append(c),c.append(l),c.append(s),c.append(g),g.append(m),l.append(a.join(".")),s.append(await t.compileLine(t.base.stdnToInlinePlainStringLine(e.children))),o.pagedListeners.push((async()=>{const t=o.unitOrLineToPage.get(e);void 0!==t&&(m.textContent=t.frontIndex.toString());const{widthScale:i}=n(g);if(!isFinite(i))return;let{left:a}=c.getBoundingClientRect();const{top:d,left:l}=m.getBoundingClientRect();for(const{right:e,bottom:t}of s.getClientRects())t>=d&&e>a&&(a=e);if(l<=a)return;const h=Math.floor((l-a)*i/r);for(let e=0;e<h;e++){const e=document.createElement("div");e.style.width=`${r}em`,m.before(e)}}))}return i},b=async(e,t)=>{const n=document.createElement("h1");return n.append(await t.compileSTDN(e.children)),n};var w=t.i0,L=t.IQ,x=t.h0,y=t.Md,E=t.$F,T=t._8;export{w as compilerToEnv,L as contents,x as h0,y as page,E as parseLength,T as parseSize};